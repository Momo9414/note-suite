<div class="form-container">
  <div class="form-card">
    <h2>{{ isEditMode ? 'Modifier la note' : 'Nouvelle note' }}</h2>
    
    <form [formGroup]="noteForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label>Titre</label>
        <input type="text" formControlName="title" class="form-control" placeholder="Titre de la note">
        @if (noteForm.get('title')?.invalid && noteForm.get('title')?.touched) {
          <div class="error">Le titre doit contenir entre 3 et 255 caractères</div>
        }
      </div>

      <div class="form-group">
        <label>Contenu (Markdown)</label>
        <textarea formControlName="contentMd" class="form-control" rows="10" 
                  placeholder="# Titre&#10;&#10;Contenu en **Markdown**..."></textarea>
      </div>

      <div class="form-group">
        <label class="form-label">
          <span>Visibilité</span>
          <span class="label-hint">Définissez qui peut voir cette note</span>
        </label>
        <div class="visibility-options">
          <label class="visibility-option" [class.active]="noteForm.get('visibility')?.value === 'PRIVATE'">
            <input type="radio" formControlName="visibility" value="PRIVATE" class="vis-radio">
            <div class="vis-content">
              <div class="vis-icon private">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                  <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
              </div>
              <div class="vis-info">
                <div class="vis-name">Privée</div>
                <div class="vis-desc">Seulement vous pouvez voir cette note</div>
              </div>
            </div>
          </label>
          
          <label class="visibility-option" [class.active]="noteForm.get('visibility')?.value === 'SHARED'">
            <input type="radio" formControlName="visibility" value="SHARED" class="vis-radio">
            <div class="vis-content">
              <div class="vis-icon shared">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                </svg>
              </div>
              <div class="vis-info">
                <div class="vis-name">Partagée</div>
                <div class="vis-desc">Accessible via un lien partagé unique</div>
              </div>
            </div>
          </label>
          
          <label class="visibility-option" [class.active]="noteForm.get('visibility')?.value === 'PUBLIC'">
            <input type="radio" formControlName="visibility" value="PUBLIC" class="vis-radio">
            <div class="vis-content">
              <div class="vis-icon public">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="2" y1="12" x2="22" y2="12"></line>
                  <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                </svg>
              </div>
              <div class="vis-info">
                <div class="vis-name">Publique</div>
                <div class="vis-desc">Tous les utilisateurs authentifiés peuvent voir</div>
              </div>
            </div>
          </label>
        </div>
      </div>

      <div class="form-group">
        <label>Tags (séparés par des virgules)</label>
        <input type="text" formControlName="tagsInput" class="form-control" 
               placeholder="travail, important, urgent">
      </div>

      @if (errorMessage) {
        <div class="error">{{ errorMessage }}</div>
      }

      <div class="form-actions">
        <button type="button" class="btn-secondary" (click)="cancel()">Annuler</button>
        <button type="submit" [disabled]="noteForm.invalid || loading" class="btn-primary">
          {{ loading ? 'Enregistrement...' : (isEditMode ? 'Modifier' : 'Créer') }}
        </button>
      </div>
    </form>
  </div>
</div>

